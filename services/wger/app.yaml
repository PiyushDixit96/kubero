apiVersion: application.kubero.dev/v1alpha1
kind: KuberoApp
metadata:
    name: wger
    annotations:
        kubero.dev/template.architecture: '["linux/amd64", "linux/arm64"]'
        kubero.dev/template.description: "Self hosted FLOSS fitness/workout, nutrition and weight tracker"
        kubero.dev/template.icon: "https://avatars.githubusercontent.com/u/17430347"
        kubero.dev/template.installation: ""
        kubero.dev/template.links: '["https://wger.readthedocs.io/en/latest/"]'
        kubero.dev/template.screenshots: '["https://raw.githubusercontent.com/wger-project/wger/master/wger/software/static/images/screens-3.png"]'
        kubero.dev/template.source: "https://github.com/wger-project/wger"
        kubero.dev/template.categories: '["utilities"]'
        kubero.dev/template.title: "wger"
        kubero.dev/template.website: "https://wger.de/"
    labels:
        manager: kubero
spec:
    name: wger
    deploymentstrategy: docker
    envVars:
        - name: SECRET_KEY
          value: wger-docker-supersecret-key-1234567890!@#$%^&*(-_)
        - name: SIGNING_KEY
          value: wger-docker-secret-jwtkey-1234567890!@#$%^&*(-_=+)
        - name: TIME_ZONE
          value: Europe/Berlin
        - name: WGER_INSTANCE
          value: https://wger.de
        - name: ALLOW_REGISTRATION
          value: "True"
        - name: ALLOW_GUEST_USERS
          value: "True"
        - name: ALLOW_UPLOAD_VIDEOS
          value: "True"
        - name: MIN_ACCOUNT_AGE_TO_TRUST
          value: "21"
        - name: SYNC_EXERCISES_CELERY
          value: "False"
        - name: SYNC_EXERCISE_IMAGES_CELERY
          value: "False"
        - name: SYNC_EXERCISE_VIDEOS_CELERY
          value: "False"
        - name: SYNC_INGREDIENTS_CELERY
          value: "True"
        - name: DOWNLOAD_INGREDIENTS_FROM
          value: WGER
        - name: USE_CELERY
          value: "True"
        - name: CELERY_BROKER
          value: redis://wger-redis-master:6379/2
        - name: CELERY_BACKEND
          value: redis://wger-redis-master:6379/2
        - name: CELERY_FLOWER_PASSWORD
          value: wger
        - name: ENABLE_EMAIL
          value: "False"
        - name: USE_RECAPTCHA
          value: "False"
        - name: DJANGO_CLEAR_STATIC_FIRST
          value: "False"
        - name: NUMBER_OF_PROXIES
          value: "1"
        - name: REFRESH_TOKEN_LIFETIME
          value: "24"
        - name: ACCESS_TOKEN_LIFETIME
          value: "10"
        - name: DJANGO_DB_ENGINE
          value: django.db.backends.postgresql
        - name: DJANGO_DB_DATABASE
          value: wger
        - name: DJANGO_DB_USER
          value: wger
        - name: DJANGO_DB_PASSWORD
          value: wger
        - name: DJANGO_DB_HOST
          value: wger-postgresql
        - name: DJANGO_DB_PORT
          value: "5432"
        - name: DJANGO_PERFORM_MIGRATIONS
          value: "True"
        - name: DJANGO_CACHE_BACKEND
          value: django_redis.cache.RedisCache
        - name: DJANGO_CACHE_LOCATION
          value: redis://:wger@wger-redis-master:6379/1
        - name: DJANGO_CACHE_TIMEOUT
          value: "1296000"
        - name: DJANGO_CACHE_CLIENT_CLASS
          value: django_redis.client.DefaultClient
        - name: STATIC_URL
          value: https://wger.localhost/static/
        - name: X_FORWARDED_PROTO_HEADER_SET
          value: "True"
        - name: CSRF_TRUSTED_ORIGINS
          value: https://wger.localhost,https://8.8.8.8
        - name: DJANGO_DEBUG
          value: "False"
    extraVolumes:
        - accessMode: ReadWriteOnce
          accessModes:
              - ReadWriteOnce
          emptyDir: false
          mountPath: /home/wger/media
          name: wger-media-volume
          size: 1Gi
          storageClass: standard
        - accessMode: ReadWriteOnce
          accessModes:
              - ReadWriteOnce
          emptyDir: false
          mountPath: /home/wger/static
          name: wger-static-volume
          size: 1Gi
          storageClass: standard
    cronjobs: []
    addons:
        - displayName: Redis
          env: []
          icon: /img/addons/redis.svg
          id: kubero-operator
          kind: KuberoRedis
          resourceDefinitions:
              KuberoRedis:
                  apiVersion: application.kubero.dev/v1alpha1
                  kind: KuberoRedis
                  metadata:
                      name: wger-redis
                  spec:
                      redis:
                          architecture: replication
                          global:
                              redis:
                                  password: wger
                              storageClass: standard
                          master:
                              persistence:
                                  size: 1Gi
                          replica:
                              persistence:
                                  size: 1Gi
                              replicaCount: 1
          version:
              latest: 0.1.8
        - displayName: Postgresql
          env: []
          icon: /img/addons/pgsql.svg
          id: kubero-operator
          kind: KuberoPostgresql
          resourceDefinitions:
              KuberoPostgresql:
                  apiVersion: application.kubero.dev/v1alpha1
                  kind: KuberoPostgresql
                  metadata:
                      name: wger-postgresql
                  spec:
                      postgresql:
                          global:
                              postgresql:
                                  auth:
                                      database: wger
                                      password: wger
                                      postgresPassword: wger
                                      username: wger
                              storageClass: standard
                          primary:
                              persistence:
                                  size: 1Gi
          version:
              latest: 0.1.8
    web:
        replicaCount: 1
    worker:
        replicaCount: 0
    image:
        containerPort: "8000"
        pullPolicy: Always
        repository: wger/server
        tag: latest
        run:
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              add: []
              drop: []
            readOnlyRootFilesystem: false
            runAsGroup: 1000
            runAsNonRoot: false
            runAsUser: 1000